stages:
    - lint
    - test
    - build

lint:
  image: golang:alpine
  stage: lint
  before_script:
    - apk add --no-cache make
    - go install golang.org/x/lint/golint
  script:
    - make lint

test:
  image: golang:alpine
  stage: test
  before_script:
    - apk add --no-cache make
  script:
    - make test

build:
  services:
    - docker:dind
  stage: build
  image: docker:latest
  needs:
    - lint
    - test
  script:
    - docker build -t gobuild .
    - docker run gobuild